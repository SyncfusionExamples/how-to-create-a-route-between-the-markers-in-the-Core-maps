@{
    ViewData["Title"] = "Home Page";
}

@using Syncfusion.EJ2.Maps
@using Syncfusion.EJ2

<script>
    var source;
    var destination;
    document.addEventListener('DOMContentLoaded', function () {
        initMap();
    });
    function initMap() {
        var directionsService = new google.maps.DirectionsService();
        var onButtonClick = function () {
            source = document.getElementById('input').value.toLowerCase();
            destination = document.getElementById('output').value.toLowerCase();
            if (
                source !== null &&
                source !== '' &&
                destination !== null &&
                destination !== ''
            ) {
                calculateAndDisplayRoute(directionsService);
            }
        };
        document.getElementById('route').addEventListener('click', onButtonClick);
    }

    function calculateAndDisplayRoute(directionsService) {
        directionsService
            .route({
                origin: {
                    query: source,
                },
                destination: {
                    query: destination,
                },
                travelMode: google.maps.TravelMode.DRIVING,
            })
            .then((response) => {
                maps.ej2_instances[0].zoomSettings.shouldZoomInitially = true;
                var markers = maps.ej2_instances[0].layers[0].markerSettings;
                markers[0].dataSource = [];
                markers[0].dataSource.push({
                    latitude: response.routes[0].legs[0].start_location.lat(),
                    longitude: response.routes[0].legs[0].start_location.lng(),
                });
                markers[0].dataSource.push({
                    latitude: response.routes[0].legs[0].end_location.lat(),
                    longitude: response.routes[0].legs[0].end_location.lng(),
                });
                var navigationLines = maps.ej2_instances[0].layers[0].navigationLineSettings;
                var coordinates = response.routes[0].overview_path;
                var latitudes = [];
                var longitudes = [];
                for (var i = 0; i < coordinates.length; i++) {
                    latitudes.push(coordinates[i].lat());
                    longitudes.push(coordinates[i].lng());
                }
                navigationLines[0].latitude = latitudes;
                navigationLines[0].longitude = longitudes;
            })
            .catch((e) => window.alert('Directions request failed due to ' + status));
    }
</script>

<div>
    <label for="textInput">Source: </label>
    <input type="text" id="input" name="textInput" /><br />
    <br />
    <label for="textOutput">Destination: </label>
    <input type="text" id="output" name="textOutput" /><br /><br />
    <button id="route">Add Route</button>
</div>

<ejs-maps id="maps">
    <e-maps-zoomsettings enable="true"></e-maps-zoomsettings>
    <e-maps-layers >
        <e-maps-layer urlTemplate="http://a.tile.openstreetmap.org/level/tileX/tileY.png">
            <e-layersettings-markers>
                <e-layersettings-marker visible="true"
                                        shape="Image" height="20" width="20"
                                        imageUrl="https://ej2.syncfusion.com/aspnetcore/styles/images/maps/ballon.png"></e-layersettings-marker>
            </e-layersettings-markers>
            <e-layersettings-navigationlines>
                <e-layersettings-navigationline visible="true" color="black" angle="0" width="2">
                </e-layersettings-navigationline>
            </e-layersettings-navigationlines>
        </e-maps-layer>
    </e-maps-layers>
</ejs-maps>

